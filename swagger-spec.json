{"openapi":"3.0.0","paths":{"/api/users":{"post":{"operationId":"UsersController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateUserDto"}}}},"responses":{"201":{"description":""}},"tags":["Users"]},"get":{"operationId":"UsersController_findAll","parameters":[],"responses":{"200":{"description":""}},"tags":["Users"]}},"/api/users/{id}":{"get":{"operationId":"UsersController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Users"]},"patch":{"operationId":"UsersController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateUserDto"}}}},"responses":{"200":{"description":""}},"tags":["Users"]},"delete":{"operationId":"UsersController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Users"]}},"/api/addresses":{"post":{"operationId":"AddressesController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateAddressDto"}}}},"responses":{"201":{"description":""}},"tags":["Addresses"]},"get":{"operationId":"AddressesController_findAll","parameters":[{"name":"userId","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Addresses"]}},"/api/addresses/{id}":{"get":{"operationId":"AddressesController_findById","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Addresses"]},"patch":{"operationId":"AddressesController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateAddressDto"}}}},"responses":{"200":{"description":""}},"tags":["Addresses"]},"delete":{"operationId":"AddressesController_delete","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Addresses"]}},"/api/cities":{"post":{"operationId":"CitiesController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateCityDto"}}}},"responses":{"201":{"description":""}},"tags":["Cities"]},"get":{"operationId":"CitiesController_findAll","parameters":[],"responses":{"200":{"description":""}},"tags":["Cities"]}},"/api/cities/{id}":{"get":{"operationId":"CitiesController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Cities"]},"patch":{"operationId":"CitiesController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateCityDto"}}}},"responses":{"200":{"description":""}},"tags":["Cities"]},"delete":{"operationId":"CitiesController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"tags":["Cities"]}},"/api/carriers/quote":{"post":{"description":"Obtiene el costo de envío usando códigos de Chilexpress directamente  Para obtener los códigos correctos, usar primero GET /geo/chilexpress/regions y luego GET /geo/chilexpress/coverage-areas","operationId":"CarriersController_quote","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/QuoteRequestDto"},"examples":{"Usando countyCode":{"value":{"originCountyCode":"STGO","destinationCountyCode":"PROV","package":{"weight":"2.5","height":"15","width":"25","length":"35"},"productType":3,"contentType":1,"declaredWorth":"25000","deliveryTime":0}}}}}},"responses":{"200":{"description":"Cotización exitosa con opciones de servicio","content":{"application/json":{"schema":{"$ref":"#/components/schemas/QuoteResponseDto"}}}}},"summary":"Cotizar envío","tags":["Carriers"]}},"/api/carriers":{"post":{"operationId":"CarriersController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateCarrierDto"}}}},"responses":{"201":{"description":""}},"summary":"Crear un nuevo carrier","tags":["Carriers"]},"get":{"operationId":"CarriersController_findAll","parameters":[],"responses":{"200":{"description":""}},"summary":"Listar todos los carriers","tags":["Carriers"]}},"/api/carriers/{id}":{"get":{"operationId":"CarriersController_findById","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Obtener carrier por ID","tags":["Carriers"]},"patch":{"operationId":"CarriersController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateCarrierDto"}}}},"responses":{"200":{"description":""}},"summary":"Actualizar carrier","tags":["Carriers"]},"delete":{"operationId":"CarriersController_delete","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Eliminar carrier","tags":["Carriers"]}},"/api/geo/cl/regions":{"get":{"description":"Obtiene regiones, provincias y comunas","operationId":"GeoController_getRegions","parameters":[],"responses":{"200":{"description":""}},"summary":"Obtener regiones de Chile","tags":["Geo"]}},"/api/deliveries/create-from-payment":{"post":{"description":"Endpoint llamado automáticamente por el microservicio de Pagos cuando un pago se completa. Crea el envío con estado \"Preparando\" y genera el tracking number.","operationId":"DeliveriesController_createFromPayment","parameters":[],"requestBody":{"required":true,"description":"Datos del pago y envío","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateDeliveryFromPaymentDto"},"examples":{"example1":{"summary":"Ejemplo completo","value":{"paymentId":"pay_abc123","cartId":"cart_xyz789","userId":"user_456","sellerId":"seller_789","totalAmount":950000,"items":[{"productId":"prod_12345","name":"iPhone 14 Pro 256GB","quantity":1,"price":899990}],"package":{"weight":0.5,"length":20,"width":15,"height":10},"shippingInfo":{"originAddressId":"addr_origin_123","destinationAddressId":"addr_dest_456","carrierName":"Chilexpress","serviceType":"PRIORITARIO","estimatedCost":8812},"declaredWorth":50000,"notes":"Entregar en horario de oficina"}}}}}},"responses":{"201":{"description":"Envío creado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryResponseDto"},"example":{"trackingNumber":"ENV-1734480000000-A3B7F9","status":"Preparando","paymentId":"pay_abc123","cartId":"cart_xyz789","userId":"user_456","sellerId":"seller_789","carrierName":"Chilexpress","serviceType":"PRIORITARIO","estimatedCost":8812,"currency":"CLP","originAddressId":"addr_origin_123","destinationAddressId":"addr_dest_456","items":[{"productId":"prod_12345","name":"iPhone 14 Pro 256GB","quantity":1,"price":899990}],"estimatedDeliveryDate":"2024-12-18T10:00:00Z","createdAt":"2024-12-17T15:30:00Z","message":"Envío creado exitosamente. El vendedor ha sido notificado."}}}},"400":{"description":"Datos inválidos o envío ya existe para este pago"},"500":{"description":"Error al crear el envío"}},"summary":"Crear envío desde pago completado","tags":["deliveries"]}},"/api/deliveries":{"get":{"operationId":"DeliveriesController_findAll","parameters":[],"responses":{"200":{"description":"Lista de envíos"}},"summary":"Listar todos los envíos","tags":["deliveries"]}},"/api/deliveries/{id}":{"get":{"operationId":"DeliveriesController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Envío encontrado"},"404":{"description":"Envío no encontrado"}},"summary":"Obtener envío por ID","tags":["deliveries"]},"patch":{"operationId":"DeliveriesController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeliveryDto"}}}},"responses":{"200":{"description":"Envío actualizado"},"404":{"description":"Envío no encontrado"}},"summary":"Actualizar envío","tags":["deliveries"]},"delete":{"operationId":"DeliveriesController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Envío eliminado"}},"summary":"Eliminar envío","tags":["deliveries"]}}},"info":{"title":"PulgaShop - Microservicio Envíos","description":"API para direcciones y transportistas","version":"1.0","contact":{}},"tags":[],"servers":[],"components":{"schemas":{"CreateUserDto":{"type":"object","properties":{"name":{"type":"string"},"lastName":{"type":"string"},"email":{"type":"string"},"password":{"type":"string"}},"required":["name","lastName","email","password"]},"UpdateUserDto":{"type":"object","properties":{}},"CreateAddressDto":{"type":"object","properties":{"street":{"type":"string"},"number":{"type":"string"},"comune":{"type":"string"},"communeCode":{"type":"string","description":"Código DPA de la comuna (opcional, se usa para cotizar)"},"province":{"type":"string"},"region":{"type":"string"},"postalCode":{"type":"string"},"references":{"type":"string"},"userId":{"type":"string"}},"required":["street","number","comune","province","region","userId"]},"UpdateAddressDto":{"type":"object","properties":{"street":{"type":"string"},"number":{"type":"string"},"comune":{"type":"string"},"communeCode":{"type":"string","description":"Código DPA de la comuna (opcional, se usa para cotizar)"},"province":{"type":"string"},"region":{"type":"string"},"postalCode":{"type":"string"},"references":{"type":"string"},"userId":{"type":"string"}}},"CreateCityDto":{"type":"object","properties":{"name":{"type":"string","example":"Santo Domingo"},"postal_code":{"type":"string","example":"2720000"}},"required":["name","postal_code"]},"UpdateCityDto":{"type":"object","properties":{}},"PackageInfoDto":{"type":"object","properties":{"weight":{"type":"string","example":"2.5","description":"Peso del paquete en kilogramos (separado por punto)"},"height":{"type":"string","example":"15","description":"Alto del paquete en centímetros"},"width":{"type":"string","example":"25","description":"Ancho del paquete en centímetros"},"length":{"type":"string","example":"35","description":"Largo del paquete en centímetros"}},"required":["weight","height","width","length"]},"QuoteRequestDto":{"type":"object","properties":{"originCommuneId":{"type":"string","example":"13101","description":"Código DPA de la comuna de origen (ej: 13101 = Santiago, 05109 = Viña del Mar). Usar solo si no se envía originCountyCode"},"destinationCommuneId":{"type":"string","example":"05109","description":"Código DPA de la comuna de destino (ej: 13101 = Santiago, 05109 = Viña del Mar). Usar solo si no se envía destinationCountyCode"},"originCountyCode":{"type":"string","example":"STGO","description":"Código de cobertura de Chilexpress para origen (obtenido desde /geo/chilexpress/coverage-areas). Tiene prioridad sobre originCommuneId"},"destinationCountyCode":{"type":"string","example":"VAP","description":"Código de cobertura de Chilexpress para destino (obtenido desde /geo/chilexpress/coverage-areas). Tiene prioridad sobre destinationCommuneId"},"package":{"description":"Información del paquete a enviar","allOf":[{"$ref":"#/components/schemas/PackageInfoDto"}]},"productType":{"type":"number","example":3,"description":"Tipo de producto: 1 = Documento, 3 = Encomienda","enum":[1,3]},"contentType":{"type":"number","example":1,"description":"Tipo de contenido del paquete"},"declaredWorth":{"type":"string","example":"25000","description":"Valor declarado del paquete en pesos chilenos"},"deliveryTime":{"type":"number","example":0,"description":"Servicios de entrega: 0 = Todos, 1 = Prioritarios, 2 = No prioritarios, 3 = De devolución","enum":[0,1,2,3],"default":0}},"required":["package","productType","contentType","declaredWorth","deliveryTime"]},"ServiceOptionDto":{"type":"object","properties":{"serviceName":{"type":"string","example":"PRIORITARIO","description":"Nombre del servicio de envío"},"serviceCode":{"type":"string","example":"PRI","description":"Código del servicio"},"serviceValue":{"type":"number","example":8500,"description":"Costo del servicio en pesos chilenos"},"deliveryTime":{"type":"string","example":"1 día hábil","description":"Tiempo estimado de entrega"},"available":{"type":"boolean","example":true,"description":"Indica si el servicio está disponible"}},"required":["serviceName","serviceCode","serviceValue","deliveryTime","available"]},"QuoteResponseDto":{"type":"object","properties":{"statusCode":{"type":"number","example":0,"description":"Código de estado de la respuesta (0 = éxito)"},"statusDescription":{"type":"string","example":"Cotización exitosa","description":"Descripción del estado"},"serviceOptions":{"description":"Lista de opciones de servicio disponibles","type":"array","items":{"$ref":"#/components/schemas/ServiceOptionDto"}},"originCommuneId":{"type":"string","example":"13101","description":"Código de comuna de origen utilizado"},"destinationCommuneId":{"type":"string","example":"05109","description":"Código de comuna de destino utilizado"},"originCountyCode":{"type":"string","example":"SCL","description":"Código de cobertura Chilexpress de origen"},"destinationCountyCode":{"type":"string","example":"VAP","description":"Código de cobertura Chilexpress de destino"},"error":{"type":"string","description":"Mensaje de error si la cotización falló"},"rawData":{"type":"object","description":"Datos adicionales de la respuesta de Chilexpress"}},"required":["statusCode","statusDescription","serviceOptions","originCommuneId","destinationCommuneId","originCountyCode","destinationCountyCode","error","rawData"]},"CreateCarrierDto":{"type":"object","properties":{"name":{"type":"string","example":"DHL"},"credentials":{"type":"object","example":{"X-API-AppKey":"Luke Skywalker","X-API-AppToken":"R2D2"}},"isActive":{"type":"boolean","example":true}},"required":["name","credentials","isActive"]},"UpdateCarrierDto":{"type":"object","properties":{}},"CartItemDto":{"type":"object","properties":{"productId":{"type":"string","example":"prod_12345","description":"ID del producto"},"name":{"type":"string","example":"iPhone 14 Pro","description":"Nombre del producto"},"quantity":{"type":"number","example":1,"description":"Cantidad"},"price":{"type":"number","example":899990,"description":"Precio unitario"}},"required":["productId","name","quantity","price"]},"ShippingInfoDto":{"type":"object","properties":{"originAddressId":{"type":"string","example":"addr_12345","description":"ID de dirección de origen"},"destinationAddressId":{"type":"string","example":"addr_67890","description":"ID de dirección de destino"},"carrierName":{"type":"string","example":"Chilexpress","description":"Nombre del carrier"},"serviceType":{"type":"string","example":"PRIORITARIO","description":"Tipo de servicio"},"estimatedCost":{"type":"number","example":8812,"description":"Costo estimado del envío"}},"required":["originAddressId","destinationAddressId","carrierName","serviceType","estimatedCost"]},"CreateDeliveryFromPaymentDto":{"type":"object","properties":{"paymentId":{"type":"string","example":"pay_abc123","description":"ID del pago completado"},"cartId":{"type":"string","example":"cart_xyz789","description":"ID del carrito"},"userId":{"type":"string","example":"user_456","description":"ID del usuario comprador"},"sellerId":{"type":"string","example":"seller_789","description":"ID del vendedor"},"totalAmount":{"type":"number","example":950000,"description":"Monto total del pago"},"items":{"description":"Items del carrito","type":"array","items":{"$ref":"#/components/schemas/CartItemDto"}},"package":{"description":"Información del paquete","allOf":[{"$ref":"#/components/schemas/PackageInfoDto"}]},"shippingInfo":{"description":"Información de envío (previamente cotizada)","allOf":[{"$ref":"#/components/schemas/ShippingInfoDto"}]},"declaredWorth":{"type":"number","example":50000,"description":"Valor declarado para seguro"},"notes":{"type":"string","example":"Envío de compra online - Manejar con cuidado","description":"Notas adicionales"}},"required":["paymentId","cartId","userId","sellerId","totalAmount","items","package","shippingInfo"]},"DeliveryResponseDto":{"type":"object","properties":{"trackingNumber":{"type":"string","example":"ENV-1734480000000-A3B7F9","description":"Número de tracking único"},"status":{"type":"string","example":"Preparando","enum":["Preparando","EnTransito","Entregado","Cancelado","Devuelto"],"description":"Estado actual del envío"},"paymentId":{"type":"string","example":"pay_abc123","description":"ID del pago"},"cartId":{"type":"string","example":"cart_xyz789","description":"ID del carrito"},"userId":{"type":"string","example":"user_456","description":"ID del usuario"},"sellerId":{"type":"string","example":"seller_789","description":"ID del vendedor"},"carrierName":{"type":"string","example":"Chilexpress","description":"Nombre del carrier"},"serviceType":{"type":"string","example":"PRIORITARIO","description":"Tipo de servicio"},"estimatedCost":{"type":"number","example":8812,"description":"Costo estimado"},"currency":{"type":"string","example":"CLP","description":"Moneda"},"originAddressId":{"type":"string","example":"addr_12345","description":"ID dirección origen"},"destinationAddressId":{"type":"string","example":"addr_67890","description":"ID dirección destino"},"items":{"example":[{"productId":"prod_1","name":"iPhone 14","quantity":1,"price":899990}],"description":"Items incluidos en el envío","type":"array","items":{"type":"string"}},"estimatedDeliveryDate":{"format":"date-time","type":"string","example":"2024-12-20T10:00:00Z","description":"Fecha estimada de entrega"},"createdAt":{"format":"date-time","type":"string","example":"2024-12-17T15:30:00Z","description":"Fecha de creación"},"message":{"type":"string","example":"Envío creado exitosamente. El vendedor ha sido notificado.","description":"Mensaje informativo"}},"required":["trackingNumber","status","paymentId","cartId","userId","sellerId","carrierName","serviceType","estimatedCost","currency","originAddressId","destinationAddressId","items","estimatedDeliveryDate","createdAt","message"]},"PackageDto":{"type":"object","properties":{"weight":{"type":"string","example":"16","description":"Package weight (kg)"},"height":{"type":"string","example":"10","description":"Package height (cm)"},"width":{"type":"string","example":"20","description":"Package width (cm)"},"length":{"type":"string","example":"30","description":"Package length (cm)"}},"required":["weight","height","width","length"]},"DeliveryDto":{"type":"object","properties":{"originCountyCode":{"type":"string","example":"STGO","description":"Origin commune DPA code (API Gobierno)"},"destinationCountyCode":{"type":"string","example":"PROV","description":"Destination commune DPA code (API Gobierno)"},"package":{"$ref":"#/components/schemas/PackageDto"},"productType":{"type":"number","example":3,"description":"Product type code"},"contentType":{"type":"number","example":1,"description":"Content type code"},"declaredWorth":{"type":"string","example":"2333","description":"Declared worth (currency amount)"},"deliveryTime":{"type":"number","example":0,"description":"Delivery time preference (0 = standard)"}},"required":["originCountyCode","destinationCountyCode","package","productType","contentType","declaredWorth","deliveryTime"]}}}}